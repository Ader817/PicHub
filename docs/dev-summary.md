# PicHub 开发小结

## 1. 项目完成情况
本项目围绕课程大作业的 11 个基础功能与 2 个增强功能实现了完整闭环：注册登录、上传存储、EXIF/缩略图、标签与检索、轮播展示、在线编辑与副本保存、删除、移动端适配，并提供 AI 标签与自然语言检索能力。

## 2. 关键技术决策与取舍
- 技术栈收敛：以 Vue3 + Node/Express + MySQL 为最终落地，避免早期规划与实现分裂
- “对话式检索”实现路径：优先实现可复用的 `NL → 结构化条件 → 搜索` 链路（`/api/images/nl-search`），将协议层（MCP）与业务逻辑解耦
- 文件与数据持久化：上传文件与 MySQL 使用 Docker volume，保证容器重启不丢数据
- 标签体系：统一表结构，通过 `tag_type` 区分 `custom/ai/auto`，并在编辑副本时继承原图标签
- 前端编辑“烘焙”策略：使用 Canvas 将裁剪结果与滤镜合成导出，再上传后端保存，确保导出图片与预览一致

## 3. 典型问题与解决
- Docker 拉取镜像失败（TLS/EOF）：识别为网络/镜像源问题，建议预拉取镜像或切换网络环境
- Node/Vite 版本兼容：Vite 对 Node 版本有要求，最终统一到可用版本并在 Dockerfile 中固定
- 中文文件名乱码：兼容 multipart 历史编码问题（latin1/utf8），在后端上传时做“疑似乱码”纠正
- MySQL 与 SQLite 差异：例如 ENUM 扩展等，补充启动时的 schema 自检/兼容逻辑，避免仅在 SQLite 测试下“看似可用”
- 外部 AI 服务不稳定：为 Gemini 调用添加超时与更友好的错误提示，避免 UI “没反应”

## 4. 对可维护性的改进
- OpenAPI 文档完善：接口可在 Swagger UI 中直接查看与调试（`/api-docs`）
- 前端设计系统：统一字体、本地自托管，减少外网依赖；同时优化空态/错误提示降低困惑
- 小步提交：将功能拆成多个小 commit，便于回溯与验收对照

## 5. 后续可优化方向
- 前端测试体系：引入 Vitest/Cypress 等覆盖关键交互（上传、搜索、编辑、轮播）
- 搜索效果提升：对 NL 搜索增加“同义标签扩展/提示排序”，提升召回与可解释性

