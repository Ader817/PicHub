# PicHub 测试报告

## 1. 测试环境
- OS：macOS（开发机）/ Docker Desktop（运行）
- 后端：Node.js（见 `backend/package.json`），MySQL 8（Docker）
- 前端：Vite + Vue 3（见 `frontend/package.json`）
- 浏览器：Chrome / Safari（含移动端宽度模拟）

## 2. 自动化测试

### 2.1 后端（Jest + Supertest）
- 位置：`backend/src/__tests__/`
- 覆盖内容（按文件）：
  - `auth.test.js`：注册/登录/鉴权基本路径
  - `images.test.js`：上传、缩略图生成、列表/详情等关键链路
  - `tags.test.js`：标签增删、类型与去重
  - `autoTags.test.js`：自动标签（时间/地点路径）逻辑
  - `search.test.js`：条件搜索、NL 搜索结构化查询路径

运行方式：
- `cd backend && npm test`

### 2.2 前端（轻量单测）
- 位置：`frontend/src/lib/__tests__/api.test.js`
- 说明：当前仓库前端未配置独立的单测运行脚本，测试以“构建检查 + 手工验收”为主。

### 2.3 前端构建检查
- `cd frontend && npm run build`

## 3. 手工验收用例

### 3.1 基础功能验收
1. 注册：输入用户名/邮箱/密码，校验长度与唯一性，成功后可登录
2. 登录：成功后进入图库页；退出登录后资源不可访问
3. 上传：从 PC/手机浏览器上传多张图片（含 EXIF 的照片），上传成功后在图库可见
4. 缩略图：图库展示 small 缩略图；详情页展示 medium/原图
5. EXIF/元信息：在图片详情侧栏显示（拍摄时间、上传时间、设备信息、尺寸等——字段非空才展示）
6. 自动标签：上传后至少生成 `时间/{年}`；如配置 AMap 且解析到省/市，生成 `地点/{省}` 与 `地点/{省}/{市}`
7. 自定义标签：在详情页添加/删除标签；同一标签不重复
8. 条件搜索：在图库中按标签/关键词等筛选，结果正确；返回 0 条时显示空态与当前筛选条件
9. 自然语言搜索：输入自然语言（如“找 2026 年的照片”），返回结果；解析失败时在页面顶部显示错误原因并提示改用条件搜索
10. 轮播展示：图库点击缩略图卡片“★”加入轮播列表（最多 20 张），进入轮播页可播放
11. 编辑：进入编辑页裁剪/旋转/调色，保存副本后生成新图片；副本命名为 `原名(1).ext` 等；副本自动继承原图标签
12. 删除：删除图片后，图库/详情不再出现，且对应文件被清理
13. 移动端适配：手机宽度下界面不溢出，按钮/输入可点击，核心功能可完成

### 3.2 增强功能验收
1. AI 标签：对图片点击“生成 AI 标签”，生成 `ai` 类型标签并可用于搜索（需配置 `GEMINI_API_KEY`）
2. 对话式检索：使用 NL 搜索（`/api/images/nl-search`）演示“自然语言 → 结构化条件 → 返回图片列表”的链路

## 4. 外部依赖与降级说明
- Gemini/AMap 属于可选外部服务：
  - 未配置 key 或网络不可用时：应返回明确错误提示；核心上传/浏览/条件搜索不受影响
- Docker / 镜像拉取依赖网络：
  - 若出现 registry TLS/EOF 等问题，建议提前在可用网络环境下 `docker pull` 所需基础镜像

## 5. 已知限制
- 前端自动化测试覆盖不完整（以手工验收 + 后端接口测试为主）
- NL 搜索与 AI 标签依赖外部模型质量与网络状况，效果可能因 prompt/模型不同而波动
